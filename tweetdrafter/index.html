---
layout: nil
title: Tweet Drafter
---
<!DOCTYPE html>
<html lang="en-GB">
	<head>
		<title>{{ page.title }}</title>
		<style type='text/css'>
			body {
				font-family: Verdana, sans-serif;
				font-size: 2em;
				line-height: 1.5em;
				text-align: center;
			}

			textarea {
				font-size: inherit;
				border: 1px solid black;
				resize: none;
			}

			input[type=checkbox] {
				font-size: inherit;
			}

			{% include footer.css %}
		</style>
		<script type='text/javascript'>
			var TWEET_LENGTH = 140;
			var LEN_MEDIA = 22;
			var LEN_HTTP = 22;
			var LEN_HTTPS = 23;
			var picture = false;
			var cached = '';

			// See <https://dev.twitter.com/blog/upcoming-tco-changes>
			// for info on size limits.

			function media_toggle() {
				if( picture ) {
					picture = false;
				} else {
					picture = true;
				}

				keyed(document.getElementById("draft"), true);
			}

			function keyed(draft, toggled) {
				var url_regex = /(https?:\/\/[^\s]+)/g;
				var urls_status = document.getElementById("urls");
				var remaining;
				var match;

				// Protect against keypresses that don't change the string
				if( !toggled && draft.value == cached ) {
					return
				}
				cached = draft.value;

				// Get base length, taking media into account
				remaining = TWEET_LENGTH - draft.value.length;
				if( picture ) {
					remaining -= LEN_MEDIA;
				}

				// Find URLs and begin updating match number
				match = draft.value.match(url_regex);
				if( match ) {
					for( var i = 0; i < match.length; i++ ) {
						// Swap actual length of link for "shortened" version
						var url = match[i];
						remaining += url.length;
						switch( url[4] ) {
							case ':':	remaining -= LEN_HTTP;
										break;
							case 's':	remaining -= LEN_HTTPS;
										break;
							default:	alert("Malformed link: '" + url + "'");
						}
					}

					urls_status.innerHTML = match.length;
				} else {
					urls_status.innerHTML = "0";
				}

				// Update statuses
				document.getElementById("charcount")
					.innerHTML = remaining + " characters remaining";

				urls_status.innerHTML += " links in your tweet"; 
			}
		</script>
		{% include track.html %}
	</head>
	<body>
		<header>
			<h1>{{ page.title }}</h1>
		</header>
		<main role="main">
			<p>Draft your tweets before sending (does not record any data).</p>

			<textarea
				id="draft"
				rows="4"
				cols="35"
				onkeyup="keyed(this, false);"
				aria-label="Draft tweet"
				autofocus></textarea>
			<br/>
			<label>
				<input
					type="checkbox"
					onchange="media_toggle();">
				tweet includes a picture or other media
			</label>
			<div aria-live="polite">
				<span id="charcount">140 characters remaining</span>
			</div>
			<div aria-live="assertive">
				<span id="urls">0 links in your tweet</span>
			</div>
		</main>
		{% include footer.html %}
	</body>
</html>
